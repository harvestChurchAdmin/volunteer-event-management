<%- include('../partials/header', { title, user: locals.user, layoutVariant: 'public' }) %>

<section class="page-header page-shell">
  <div>
    <h1>Upcoming Sign-ups</h1>
    <p class="page-subtitle">Find a time that works for you and sign up quickly.</p>
    <%
      const brandInfo = locals.brand || {};
      const supportEmail = brandInfo.supportContactEmail || '';
      const supportName = brandInfo.supportContactName || brandInfo.orgName || 'our team';
    %>
    <p class="muted small">
      New here? <a href="/help">Read the volunteer help guide</a><% if (supportEmail) { %> or email <%= supportName %> at <a href="mailto:<%= supportEmail %>"><%= supportEmail %></a><% } %>.
    </p>
  </div>
</section>

<%- include('../partials/messages', { messages: locals.messages || {} }) %>

<section class="page-section page-shell">
  <div class="tile-grid">
    <% events.forEach(event => { %>
      <% const start = new Date(event.date_start); const end = new Date(event.date_end); %>
      <% const sameDay = start.getFullYear() === end.getFullYear() && start.getMonth() === end.getMonth() && start.getDate() === end.getDate(); %>
      <% const timeOnly = (d) => new Date(d).toLocaleTimeString(undefined, { hour:'numeric', minute:'2-digit' }); %>
      <% const isPotluck = String(event.signup_mode || '').toLowerCase() === 'potluck'; %>
      <% const heroLabel = isPotluck ? 'Potluck event' : 'Volunteer shift'; %>
      <% const heroDesc = isPotluck ? 'Sign up to contribute a dish or item.' : 'Pick a time slot to lend a hand.'; %>
      <% const heroIcon = isPotluck ? '/img/event-icon-potluck.svg' : '/img/event-icon-volunteer.svg'; %>
      <% const metaClasses = ['event-card__meta', isPotluck ? 'event-card__meta--potluck' : '', sameDay ? '' : 'event-card__meta--multiday'].filter(Boolean).join(' '); %>
      <% const startDateLabel = start.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' }); %>
      <% const endDateLabel = end.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' }); %>
      <% const startISO = start.toISOString(); const endISO = end.toISOString(); %>
      <article class="card event-card">
        <div class="event-card__hero <%= isPotluck ? 'event-card__hero--potluck' : 'event-card__hero--schedule' %>">
          <span class="event-card__hero-icon" aria-hidden="true">
            <img src="<%= heroIcon %>" alt="" loading="lazy" decoding="async">
          </span>
          <div>
            <p class="event-card__hero-label"><%= heroLabel %></p>
            <p class="event-card__hero-desc"><%= heroDesc %></p>
          </div>
        </div>
        <div class="<%= metaClasses %>">
          <span class="event-card__meta-icon" aria-hidden="true">
            <img src="/img/event-icon-calendar.svg" alt="" loading="lazy" decoding="async">
          </span>
          <div>
            <% if (sameDay) { %>
              <p class="event-card__date"><time datetime="<%= startISO %>"><%= startDateLabel %></time></p>
              <p class="event-card__time">
                <time datetime="<%= startISO %>"><%= timeOnly(start) %></time>
                &nbsp;–&nbsp;
                <time datetime="<%= endISO %>"><%= timeOnly(end) %></time>
              </p>
            <% } else { %>
              <p class="event-card__date">Starts <time datetime="<%= startISO %>"><%= startDateLabel %> · <%= timeOnly(start) %></time></p>
              <p class="event-card__time">Ends <time datetime="<%= endISO %>"><%= endDateLabel %> · <%= timeOnly(end) %></time></p>
            <% } %>
          </div>
        </div>
        <div class="event-card__body">
          <h2><%= event.name %></h2>
          <% if (event.description) { %>
            <div class="event-card__copy rich-text"><%- helpers.renderRichText(event.description) %></div>
          <% } %>
        </div>
        <div class="card-actions">
          <a href="/events/<%= event.event_id %>" class="btn btn-primary"><%= isPotluck ? 'Sign Up to Bring a Dish' : 'View sign-ups' %></a>
        </div>
      </article>
    <% }) %>
  </div>
</section>

<%- include('../partials/footer') %>
